<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surgical Logs Archive</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-muted: #888888;
            --accent: #7f6df2;
            --accent-glow: rgba(127, 109, 242, 0.2);
            --border: #333333;
            --hover-bg: #2a2a2a;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Courier New', Courier, monospace; /* Old school terminal feel */
            margin: 0;
            padding: 40px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Header Styling */
        header {
            border-bottom: 2px solid var(--accent);
            padding-bottom: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        h1 {
            margin: 0;
            font-size: 24px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--accent);
            text-shadow: 0 0 10px var(--accent-glow);
        }

        .breadcrumb {
            font-size: 14px;
            color: var(--text-muted);
        }

        .breadcrumb span {
            color: var(--text-main);
            cursor: pointer;
        }
        
        .breadcrumb span:hover {
            text-decoration: underline;
            color: var(--accent);
        }

        /* File List Styling */
        .file-list {
            list-style: none;
            padding: 0;
            margin: 0;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            transition: all 0.2s ease;
            cursor: pointer;
            text-decoration: none;
            color: var(--text-main);
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-item:hover {
            background-color: var(--hover-bg);
            padding-left: 25px; /* Slight movement effect */
            border-left: 3px solid var(--accent);
        }

        /* Icons */
        .icon {
            font-size: 20px;
            width: 40px;
            text-align: center;
            margin-right: 15px;
        }

        .fa-folder { color: #ffd700; }
        .fa-file-pdf { color: #ff5252; }
        .fa-file-code { color: var(--accent); }
        .fa-reply { color: var(--text-muted); }

        /* Text Details */
        .file-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .name {
            font-size: 16px;
            font-weight: bold;
        }

        .meta {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Action Arrow */
        .arrow {
            opacity: 0;
            color: var(--accent);
            transform: translateX(-10px);
            transition: all 0.2s ease;
        }

        .file-item:hover .arrow {
            opacity: 1;
            transform: translateX(0);
        }

        /* Loading State */
        .loader {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
            font-style: italic;
        }
        
        .error-msg {
            color: #ff5252;
            text-align: center;
            padding: 20px;
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <div>
                <h1><i class="fa-solid fa-terminal"></i> Log Viewer</h1>
                <div style="margin-top: 10px; color: var(--text-muted); font-size: 12px;">
                    Directory Listing via GitHub API
                </div>
            </div>
            <div class="breadcrumb" id="breadcrumb">
                </div>
        </header>

        <ul class="file-list" id="file-list">
            <li class="loader">Scanning repository...</li>
        </ul>
    </div>

    <script>
        // ================= CONFIGURATION =================
        // REPLACE THIS WITH YOUR GITHUB USERNAME
        const USERNAME = 'shayokdutta'; 
        const REPO = 'surgery_records';
        const BRANCH = 'main'; // or 'master'
        const BASE_PATH = 'logs'; // The folder to start looking in
        // =================================================

        const listElement = document.getElementById('file-list');
        const breadcrumbElement = document.getElementById('breadcrumb');
        
        // Track current path relative to repo root
        let currentPath = BASE_PATH;

        // Init
        fetchDirectory(currentPath);

        // Function to fetch GitHub Content
        async function fetchDirectory(path) {
            listElement.innerHTML = '<li class="loader">Scanning /' + path + ' ...</li>';
            updateBreadcrumb(path);

            try {
                const response = await fetch(`https://api.github.com/repos/${USERNAME}/${REPO}/contents/${path}?ref=${BRANCH}`);
                
                if (!response.ok) {
                    if(response.status === 404) throw new Error("Folder not found. Make sure the 'logs' folder exists in your repo.");
                    throw new Error(`GitHub API Error: ${response.status}`);
                }

                const data = await response.json();
                renderList(data, path);
                currentPath = path;

            } catch (error) {
                listElement.innerHTML = `<li class="error-msg"><i class="fa-solid fa-circle-exclamation"></i> ${error.message}</li>`;
                console.error(error);
            }
        }

        // Render the list of files
        function renderList(files, path) {
            listElement.innerHTML = '';

            // 1. Add "Go Back" folder if not at root
            if (path !== BASE_PATH) {
                const li = document.createElement('li');
                li.className = 'file-item';
                li.innerHTML = `
                    <div class="icon"><i class="fa-solid fa-reply"></i></div>
                    <div class="file-info"><span class="name">.. (Parent Directory)</span></div>
                `;
                li.onclick = () => {
                    const parentPath = path.substring(0, path.lastIndexOf('/'));
                    fetchDirectory(parentPath);
                };
                listElement.appendChild(li);
            }

            // Sort: Folders first, then files
            files.sort((a, b) => {
                if (a.type === b.type) return a.name.localeCompare(b.name);
                return a.type === 'dir' ? -1 : 1;
            });

            // 2. Render Items
            files.forEach(file => {
                const li = document.createElement('li'); // Use div or a tag based on type
                
                let icon = 'fa-file-code';
                let action = '';
                
                if (file.type === 'dir') {
                    icon = 'fa-folder';
                    // Click folder -> Drill down
                    li.onclick = () => fetchDirectory(file.path);
                } else {
                    // It's a file
                    if (file.name.endsWith('.pdf')) icon = 'fa-file-pdf';
                    // Click file -> Open raw link or blob link
                    // Use GitHub Pages URL if possible for rendering
                    const pagesUrl = `https://${USERNAME}.github.io/${REPO}/${file.path}`;
                    li.onclick = () => window.open(pagesUrl, '_blank');
                }

                li.className = 'file-item';
                li.innerHTML = `
                    <div class="icon"><i class="fa-solid ${icon}"></i></div>
                    <div class="file-info">
                        <span class="name">${file.name}</span>
                        <span class="meta">${file.type === 'dir' ? 'Folder' : (file.size / 1024).toFixed(1) + ' KB'}</span>
                    </div>
                    <div class="arrow"><i class="fa-solid fa-chevron-right"></i></div>
                `;
                listElement.appendChild(li);
            });
            
            if (files.length === 0) {
                listElement.innerHTML = '<li class="loader">Empty Directory</li>';
            }
        }

        // Update Breadcrumb UI
        function updateBreadcrumb(path) {
            const parts = path.split('/');
            let html = '';
            let buildPath = '';
            
            parts.forEach((part, index) => {
                buildPath += (index > 0 ? '/' : '') + part;
                // Don't link the current active folder
                if (index === parts.length - 1) {
                    html += ` / <span style="color:var(--accent); text-decoration:none; cursor:default;">${part}</span>`;
                } else {
                    // We need a closure or specific string to handle the click properly
                    // Simple hack: attach onclick to the span using data attributes or just rebuild
                    // For simplicity in this script, we just render visual text mostly, logic for drilling up is handled by ".."
                    // But let's make it clickable:
                    html += ` / <span onclick="fetchDirectory('${buildPath}')">${part}</span>`;
                }
            });
            breadcrumbElement.innerHTML = `<span onclick="fetchDirectory('${BASE_PATH}')"><i class="fa-solid fa-home"></i> Root</span> ${html}`;
        }
    </script>
</body>
</html>
